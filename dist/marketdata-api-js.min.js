/*! marketdata-api-js - v1.0.0 - 2015-03-18
* https://github.com/barchart/marketdata-api-js
* Copyright (c) 2015 ; Licensed  */
!function(){window.Barchart||(window.Barchart={}),window.Barchart.RealtimeData||(window.Barchart.RealtimeData={})}(),Barchart.RealtimeData.Connection=function(){function a(a,b){var c;switch(a){case"events":c=z.events;break;case"marketDepth":c=z.marketDepth[b.symbol];break;case"marketUpdate":c=z.marketUpdate[b.symbol];break;case"timestamp":c=z.timestamp}if(c)for(var d=0;d<c.length;d++)c[d](b)}function b(c,d,e){v||(A.username=d,A.password=e,A.server=c,window.WebSocket?(r="DISCONNECTED",v=new WebSocket("wss://"+A.server+"/jerq"),v.onclose=function(){console.warn(new Date+" connection closed."),v=null,"LOGGED_IN"==r&&(r="DISCONNECTED",a("events",{event:"disconnect"}),setTimeout(function(){if(v=null,b(A.server,A.username,A.password),0==t.symbols.length)for(var a in s)t.symbols.push(a)},5e3))},v.onmessage=function(a){y.push(a.data)},v.onopen=function(){console.log(new Date+" connection open.")}):(console.warn("Websockets are not supported by this browser. Invoking refreshing quotes."),setTimeout(o,1e3)))}function c(){r="DISCONNECTED",null!=v&&(v.send("LOGOUT\r\n"),v.close(),v=null),u=[],__messages=[],s={}}function d(b){if("DISCONNECTED"==r&&(r="CONNECTING"),"CONNECTING"==r)for(var d=b.split("\n"),e=0;e<d.length;e++)if("+++"==d[e])return r="LOGGING_IN",void u.push("LOGIN "+A.username+":"+A.password+" VERSION="+_API_VERSION+"\r\n");"LOGGING_IN"==r&&("+"==b.substr(0,1)?(r="LOGGED_IN",a("events",{event:"login success"})):"-"==b.substr(0,1)&&(c(),r="LOGIN_FAILED",a("events",{event:"login fail"}))),"LOGGED_IN"==r&&w.push(b)}function e(){return x}function f(){return A.password}function g(){return A.username}function h(){if(arguments.length<2)throw new Error("Bad number of arguments. Must pass in an evnetId and handler.");var a=arguments[0],b=arguments[1];switch(a){case"events":for(var c=0;c<z.events.length;c++)z.events[c]==b&&z.events.splice(c,1);break;case"marketDepth":if(arguments.length<3)throw new Error("Bad number of arguments. For marketUpdate events, please specify a symbol. on('marketUpdate', handler, symbol).");var d=arguments[2];if(!z.marketDepth[d])return;for(var c=0;c<z.marketDepth[d].length;c++)z.marketDepth[d][c]==b&&z.marketDepth[d].splice(c,1);break;case"marketUpdate":if(arguments.length<3)throw new Error("Bad number of arguments. For marketUpdate events, please specify a symbol. on('marketUpdate', handler, symbol).");var d=arguments[2];if(!z.marketUpdate[d])return;for(var c=0;c<z.marketUpdate[d].length;c++)z.marketUpdate[d][c]==b&&z.marketUpdate[d].splice(c,1)}}function i(){if(arguments.length<2)throw new Error("Bad number of arguments. Must pass in an evnetId and handler.");var a=arguments[0],b=arguments[1];switch(a){case"events":for(var c=!0,d=0;d<z.events.length;d++)z.events[d]==b&&(c=!1);c&&z.events.push(b);break;case"marketDepth":if(arguments.length<3)throw new Error("Bad number of arguments. For marketUpdate events, please specify a symbol. on('marketUpdate', handler, symbol).");var f=arguments[2];z.marketDepth[f]||(z.marketDepth[f]=[]);for(var c=!0,d=0;d<z.marketDepth[f].length;d++)z.marketDepth[f][d]==b&&(c=!1);c&&z.marketDepth[f].push(b);var g=e().getBook(f);g&&b({type:"INIT",symbol:f});break;case"marketUpdate":if(arguments.length<3)throw new Error("Bad number of arguments. For marketUpdate events, please specify a symbol. on('marketUpdate', handler, symbol).");var f=arguments[2];z.marketUpdate[f]||(z.marketUpdate[f]=[]);for(var c=!0,d=0;d<z.marketUpdate[f].length;d++)z.marketUpdate[f][d]==b&&(c=!1);c&&z.marketUpdate[f].push(b);var h=e().getQuote(f);h&&b({type:"INIT",symbol:f});break;case"timestamp":for(var c=!0,d=0;d<z.timestamp.length;d++)z.timestamp[d]==b&&(c=!1);c&&z.timestamp.push(b)}}function j(b){var c;try{if(c=Barchart.RealtimeData.MessageParser.Parse(b),c.type)switch(x.processMessage(c),c.type){case"BOOK":a("marketDepth",c);break;case"TIMESTAMP":a("timestamp",x.getTimestamp());break;default:a("marketUpdate",c)}else console.log(b)}catch(d){console.error(d),console.log(c),console.trace()}}function k(){for(var a=u.shift();a;)v.send(a),a=u.shift();setTimeout(k,200)}function l(){for(var a=!1,b=9;!a;){var c=w.shift();if(c){var d=!1,e=1,f=-1,g=c.indexOf(""),h=c.indexOf("\n");if(h>-1&&(0>g||g>h)?(f=h,e=2):g>-1&&(f=g),f>-1){var i=f+1;if(1==e&&(c.length<f+b+1?(w.length>0?w[0]=c+w[0]:(w.unshift(c),a=!0),d=!0):""==c.substr(f+1,1)&&(i+=b+1)),!d){var k=c.substring(0,i);2==e?k=k.trim():(f=k.indexOf(""),f>0&&(k=k.substring(f))),k.length>0&&j(k),c=c.substring(i),c.length>0&&(w.length>0?w[0]=c+w[0]:w.unshift(c))}}else c.length>0&&(w.length>0?w[0]=c+w[0]:(w.unshift(c),a=!0))}else a=!0;0==w.length&&(a=!0)}setTimeout(l,125)}function m(){for(var a=y.shift();a;)a&&d(a),a=y.shift();setTimeout(m,125)}function n(){if("LOGGED_IN"==r){if(t.symbols.length>0){var a=t.symbols;t.symbols=[];for(var b="GO ",c=0;c<a.length;c++)c>0&&(b+=","),b+=a[c]+"=SsBbV";u.push(b)}if(t.symbols_off.length>0){var a=t.symbols_off;t.symbols_off=[];for(var b="STOP ",c=0;c<a.length;c++)c>0&&(b+=","),b+=a[c];u.push(b)}}setTimeout(n,200)}function o(){var a=[];for(var b in s)a.push(b);$.ajax({url:"quotes.php?username="+A.username+"&password="+A.password+"&symbols="+a.join(",")}).done(function(a){$(a).find("QUOTE").each(function(){j("%"+this.outerHTML)})}),setTimeout(o,5e3)}function p(a){for(var b=0;b<a.length;b++){var c=a[b];"string"!=typeof a[b]&&(c=c.symbol),s[c]||(t.symbols.push(c),s[c]=!0)}}function q(a){for(var b=0;b<a.length;b++)s[a[b]]&&(t.symbols_off.push(a[b]),s[a[b]]=!1)}_API_VERSION=4;var r="DISCONNECTED",s={},t={symbols:[],symbols_off:[]},u=[],v=null,w=[],x=new Barchart.RealtimeData.MarketState,y=[],z={events:[],marketDepth:{},marketUpdate:{},timestamp:[]},A={username:null,password:null,server:null};return setTimeout(k,200),setTimeout(m,125),setTimeout(n,200),setTimeout(l,125),{connect:b,disconnect:c,getMarketState:e,getPassword:f,getUsername:g,off:h,on:i,requestSymbols:p,unRequestSymbols:q}},function(){window.Barchart||(window.Barchart={}),window.Barchart.RealtimeData||(window.Barchart.RealtimeData={})}(),Barchart.RealtimeData.HistoricalData=function(){function a(a,c){$.ajax({url:b,dataType:"jsonp",data:a}).done(function(a){return c(a)})}var b="proxies/historicaldata";return{getHistoricalData:a}},function(){window.Barchart||(window.Barchart={}),window.Barchart.RealtimeData||(window.Barchart.RealtimeData={})}(),Barchart.RealtimeData.MarketState=function(){function a(a,b){$.ajax({url:"proxies/instruments/?lookup="+a.join(",")}).done(function(a){if(200==a.status)for(var c=0;c<a.instruments.length;c++)200==a.instruments[c].status&&new Barchart.RealtimeData.MarketState.Profile(a.instruments[c].lookup,a.instruments[c].symbol_description,a.instruments[c].exchange_channel,a.instruments[c].base_code,a.instruments[c].point_value,a.instruments[c].tick_increment);b()})}var b={},c={},d={},e=void 0,f=function(a){return b[a]||(b[a]={symbol:a,bids:[],asks:[]}),b[a]},g=function(a){return d[a]||(d[a]=new Barchart.RealtimeData.MarketState.Quote,d[a].symbol=a),d[a]},h=function(a){if("TIMESTAMP"==a.type)return void(e=a.timestamp);var b=g(a.symbol),c=Barchart.RealtimeData.MarketState.Profile.prototype.Profiles[a.symbol];if(!c&&"REFRESH_QUOTE"!=a.type)return console.warn("No profile found for "+a.symbol),void console.log(a);if(!b.day&&a.day&&(b.day=a.day,b.dayNum=Barchart.RealtimeData.Util.DayCodeToNumber(b.day)),"BOOK"!=a.type&&b.day&&a.day){var d=Barchart.RealtimeData.Util.DayCodeToNumber(a.day);(d>b.dayNum||b.dayNum-d>5)&&(b.day=a.day,b.dayNum=d,b.flag="p",b.bidPrice=0,b.bidSize=void 0,b.askPrice=void 0,b.askSize=void 0,b.settlementPrice?b.previousPrice=b.settlementPrice:b.lastPrice&&(b.previousPrice=b.lastPrice),b.lastPrice=void 0,b.tradePrice=void 0,b.tradeSize=void 0,b.numberOfTrades=void 0,b.openPrice=void 0,b.highPrice=void 0,b.lowPrice=void 0,b.volume=void 0)}switch(a.type){case"BOOK":var h=f(a.symbol);h.asks=a.asks,h.bids=a.bids;break;case"HIGH":b.highPrice=a.value;break;case"LOW":b.lowPrice=a.value;break;case"OPEN":b.flag=void 0,b.openPrice=a.value,b.highPrice=a.value,b.lowPrice=a.value,b.lastPrice=a.value;break;case"OPEN_INTEREST":b.openInterest=a.value;break;case"REFRESH_DDF":switch(a.subrecord){case"1":case"2":case"3":b.message=a,null===a.openPrice?b.openPrice=void 0:a.openPrice&&(b.openPrice=a.openPrice),null===a.highPrice?b.highPrice=void 0:a.highPrice&&(b.highPrice=a.highPrice),null===a.lowPrice?b.lowPrice=void 0:a.lowPrice&&(b.lowPrice=a.lowPrice),null===a.lastPrice?b.lastPrice=void 0:a.lastPrice&&(b.lastPrice=a.lastPrice),null===a.bidPrice?b.bidPrice=void 0:a.bidPrice&&(b.bidPrice=a.bidPrice),null===a.askPrice?b.askPrice=void 0:a.askPrice&&(b.askPrice=a.askPrice),null===a.previousPrice?b.previousPrice=void 0:a.previousPrice&&(b.previousPrice=a.previousPrice),null===a.settlementPrice?(b.settlementPrice=void 0,"s"==b.flag&&(b.flag=void 0)):a.settlementPrice?b.settlementPrice=a.settlementPrice:(b.settlementPrice=void 0,"s"==b.flag&&(b.flag=void 0)),null===a.volume?b.volume=void 0:a.volume&&(b.volume=a.volume),null===a.openInterest?b.openInterest=void 0:a.openInterest&&(b.openInterest=a.openInterest),"1"==a.subsrecord&&(b.lastUpdate=a.time)}break;case"REFRESH_QUOTE":c=new Barchart.RealtimeData.MarketState.Profile(a.symbol,a.name,a.exchange,a.unitcode,a.pointValue,a.tickIncrement),b.message=a,b.flag=a.flag,b.mode=a.mode,b.lastUpdate=a.lastUpdate,b.bidPrice=a.bidPrice,b.bidSize=a.bidSize,b.askPrice=a.askPrice,b.askSize=a.askSize,b.lastPrice=a.lastPrice,b.tradeSize=a.tradeSize,b.numberOfTrades=a.numberOfTrades,b.previousPrice=a.previousPrice,b.settlementPrice=a.settlementPrice,b.openPrice=a.openPrice,b.highPrice=a.highPrice,b.lowPrice=a.lowPrice,b.volume=a.volume,b.openInterest=a.openInterest,a.tradeTime?b.time=a.tradeTime:a.timeStamp&&(b.time=a.timeStamp);break;case"SETTLEMENT":b.lastPrice=a.value,b.settlement=a.value,"D"==a.element&&(b.flag="s");case"TOB":b.bidPrice=a.bidPrice,b.bidSize=a.bidSize,b.askPrice=a.askPrice,b.askSize=a.askSize,a.time&&(b.time=a.time);break;case"TRADE":for(b.tradePrice=a.tradePrice,b.lastPrice=a.tradePrice,a.tradeSize&&(b.tradeSize=a.tradeSize,b.volume+=a.tradeSize),b.ticks.push({price:b.tradePrice,size:b.tradeSize});b.ticks.length>50;)b.ticks.shift();b.numberOfTrades||(b.numberOfTrades=0),b.numberOfTrades++,a.time&&(b.time=a.time),b.flag=void 0;break;case"TRADE_OUT_OF_SEQUENCE":b.volume+=a.tradeSize;break;case"VOLUME":b.volume=a.value;break;case"VOLUME_YESTERDAY":break;case"VWAP":b.vwap1=a.value;break;default:console.error("Unhandled Market Message:"),console.log(a)}};return{getBook:function(a){return b[a]},getCVol:function(a){return c[a]},getProfile:function(b,c){var d=Barchart.RealtimeData.MarketState.Profile.prototype.Profiles[b];d?c(d):a([b],function(){d=Barchart.RealtimeData.MarketState.Profile.prototype.Profiles[b],c(d)})},getQuote:function(a){return d[a]},getTimestamp:function(){return e},processMessage:h}},Barchart.RealtimeData.MarketState.Profile=function(a,b,c,d,e,f){this.symbol=a,this.name=b,this.exchange=c,this.unitCode=d,this.pointValue=e,this.tickIncrement=f;var g=Barchart.RealtimeData.Util.ParseSymbolType(this.symbol);g&&"future"==g.type&&(this.root=g.root,this.month=g.month,this.year=g.year),Barchart.RealtimeData.MarketState.Profile.prototype.Profiles[a]=this},Barchart.RealtimeData.MarketState.Profile.prototype.PriceFormatter=function(a,b){function c(a,b){return["000",Math.floor(a)].join("").substr(-1*b)}var d=void 0;d="."==a?function(a,b){if(!a)return"";switch(b){case"2":return a.toFixed(3);case"3":return a.toFixed(4);case"4":return a.toFixed(5);case"5":return a.toFixed(6);case"6":return a.toFixed(7);case"7":return a.toFixed(8);case"8":return a.toFixed(0);case"9":return a.toFixed(1);case"A":return a.toFixed(2);case"B":return a.toFixed(3);case"C":return a.toFixed(4);case"D":return a.toFixed(5);case"E":return a.toFixed(6);default:return a}}:function(d,e){if(!d)return"";var f=d>=0?"":"-";switch(d=Math.abs(d),e){case"2":return[f,Math.floor(d),a,c(8*(d-Math.floor(d)),1)].join("");case"3":return[f,Math.floor(d),a,c(16*(d-Math.floor(d)),2)].join("");case"4":return[f,Math.floor(d),a,c(32*(d-Math.floor(d)),2)].join("");case"5":return[f,Math.floor(d),a,c((d-Math.floor(d))*(b?320:64),b?3:2)].join("");case"6":return[f,Math.floor(d),a,c((d-Math.floor(d))*(b?320:128),3)].join("");case"7":return[f,Math.floor(d),a,c((d-Math.floor(d))*(b?320:256),3)].join("");case"8":return f+d.toFixed(0);case"9":return f+d.toFixed(1);case"A":return f+d.toFixed(2);case"B":return f+d.toFixed(3);case"C":return f+d.toFixed(4);case"D":return f+d.toFixed(5);case"E":return f+d.toFixed(6);default:return f+d}},Barchart.RealtimeData.MarketState.Profile.prototype.formatPrice=function(a){return d(a,this.unitCode)}},Barchart.RealtimeData.MarketState.Profile.prototype.Profiles={},Barchart.RealtimeData.MarketState.Profile.prototype.PriceFormatter("-",!0),Barchart.RealtimeData.MarketState.Quote=function(){this.symbol=null,this.message=null,this.flag=null,this.mode=null,this.day=null,this.dayNum=0,this.session=null,this.lastUpdate=null,this.bidPrice=null,this.bidSize=null,this.askPrice=null,this.askSize=null,this.lastPrice=null,this.tradePrice=null,this.tradeSize=null,this.numberOfTrades=null,this.vwap1=null,this.vwap2=null,this.settlementPrice=null,this.openPrice=null,this.highPrice=null,this.lowPrice=null,this.volume=null,this.openInterest=null,this.previousPrice=null,this.time=null,this.ticks=[]},function(){window.Barchart||(window.Barchart={}),window.Barchart.RealtimeData||(window.Barchart.RealtimeData={})}(),Barchart.RealtimeData.MessageParser={ParseTimestamp:function(a){if(9!=a.length)return null;var b=100*a.charCodeAt(0)+a.charCodeAt(1)-64,c=a.charCodeAt(2)-64-1,d=a.charCodeAt(3)-64,e=a.charCodeAt(4)-64,f=a.charCodeAt(5)-64,g=a.charCodeAt(6)-64,h=(255&a.charCodeAt(7))+((255&a.charCodeAt(8))<<8);return new Date(b,c,d,e,f,g,h)},ParseValue:function(a,b){if(a.length<1)return void 0;if("-"==a)return null;if(a.indexOf(".")>0)return parseFloat(a);switch(b){case"2":return parseInt(a.substr(0,a.length-1))+parseInt(a.substr(-1))/8;case"3":return parseInt(a.substr(0,a.length-2))+parseInt(a.substr(-2))/16;case"4":return parseInt(a.substr(0,a.length-2))+parseInt(a.substr(-2))/32;case"5":return parseInt(a.substr(0,a.length-2))+parseInt(a.substr(-2))/64;case"6":return parseInt(a.substr(0,a.length-3))+parseInt(a.substr(-3))/128;case"7":return parseInt(a.substr(0,a.length-4))+parseInt(a.substr(-3))/256;case"8":return parseInt(a);case"9":return parseInt(a)/10;case"A":return parseInt(a)/100;case"B":return parseInt(a)/1e3;case"C":return parseInt(a)/1e4;case"D":return parseInt(a)/1e5;case"E":return parseInt(a)/1e6;default:return parseInt(a)}},Parse:function(a){var b={message:a,type:null};switch(a.substr(0,1)){case"%":try{if(window.DOMParser){var c=new DOMParser;xml=c.parseFromString(a.substring(1),"text/xml")}else xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(a.substring(1))}catch(d){xml=void 0}if(xml){var e=xml.firstChild;switch(e.nodeName){case"BOOK":b.symbol=e.attributes.getNamedItem("symbol").value,b.unitcode=e.attributes.getNamedItem("basecode").value,b.askDepth=parseInt(e.attributes.getNamedItem("bidcount").value),b.bidDepth=parseInt(e.attributes.getNamedItem("bidcount").value),b.asks=[],b.bids=[];var f,g;if(e.attributes.getNamedItem("askprices")&&e.attributes.getNamedItem("asksizes")){f=e.attributes.getNamedItem("askprices").value.split(","),g=e.attributes.getNamedItem("asksizes").value.split(",");for(var h=0;h<f.length;h++)b.asks.push({price:Barchart.RealtimeData.MessageParser.ParseValue(f[h],b.unitcode),size:parseInt(g[h])})}if(e.attributes.getNamedItem("bidprices")&&e.attributes.getNamedItem("bidsizes")){f=e.attributes.getNamedItem("bidprices").value.split(","),g=e.attributes.getNamedItem("bidsizes").value.split(",");for(var h=0;h<f.length;h++)b.bids.push({price:Barchart.RealtimeData.MessageParser.ParseValue(f[h],b.unitcode),size:parseInt(g[h])})}b.type="BOOK";break;case"QUOTE":for(var h=0;h<e.attributes.length;h++){switch(e.attributes[h].name){case"symbol":b.symbol=e.attributes[h].value;break;case"name":b.name=e.attributes[h].value;break;case"exchange":b.exchange=e.attributes[h].value;break;case"basecode":b.unitcode=e.attributes[h].value;break;case"pointvalue":b.pointValue=parseFloat(e.attributes[h].value);break;case"tickincrement":b.tickIncrement=parseInt(e.attributes[h].value);break;case"flag":b.flag=e.attributes[h].value;break;case"lastupdate":var i=e.attributes[h].value;b.lastUpdate=new Date(parseInt(i.substr(0,4)),parseInt(i.substr(4,2))-1,parseInt(i.substr(6,2)),parseInt(i.substr(8,2)),parseInt(i.substr(10,2)),parseInt(i.substr(12,2)));break;case"bid":b.bidPrice=Barchart.RealtimeData.MessageParser.ParseValue(e.attributes[h].value,b.unitcode);break;case"bidsize":b.bidSize=parseInt(e.attributes[h].value);break;case"ask":b.askPrice=Barchart.RealtimeData.MessageParser.ParseValue(e.attributes[h].value,b.unitcode);break;case"asksize":b.askSize=parseInt(e.attributes[h].value);break;case"mode":b.mode=e.attributes[h].value}for(var j={},k=0;k<e.childNodes.length;k++)if("SESSION"==e.childNodes[k].nodeName){var l={},m=e.childNodes[k].attributes;if(m.getNamedItem("id")&&(l.id=m.getNamedItem("id").value),m.getNamedItem("day")&&(l.day=m.getNamedItem("day").value),m.getNamedItem("last")&&(l.lastPrice=Barchart.RealtimeData.MessageParser.ParseValue(m.getNamedItem("last").value,b.unitcode)),m.getNamedItem("previous")&&(l.previousPrice=Barchart.RealtimeData.MessageParser.ParseValue(m.getNamedItem("previous").value,b.unitcode)),m.getNamedItem("open")&&(l.openPrice=Barchart.RealtimeData.MessageParser.ParseValue(m.getNamedItem("open").value,b.unitcode)),m.getNamedItem("high")&&(l.highPrice=Barchart.RealtimeData.MessageParser.ParseValue(m.getNamedItem("high").value,b.unitcode)),m.getNamedItem("low")&&(l.lowPrice=Barchart.RealtimeData.MessageParser.ParseValue(m.getNamedItem("low").value,b.unitcode)),m.getNamedItem("tradesize")&&(l.tradeSize=parseInt(m.getNamedItem("tradesize").value)),m.getNamedItem("numtrades")&&(l.numberOfTrades=parseInt(m.getNamedItem("numtrades").value)),m.getNamedItem("settlement")&&(l.settlementPrice=Barchart.RealtimeData.MessageParser.ParseValue(m.getNamedItem("settlement").value,b.unitcode)),m.getNamedItem("volume")&&(l.volume=parseInt(m.getNamedItem("volume").value)),m.getNamedItem("openinterest")&&(l.openInterest=parseInt(m.getNamedItem("openinterest").value)),m.getNamedItem("timestamp")){var i=m.getNamedItem("timestamp").value;l.timeStamp=new Date(parseInt(i.substr(0,4)),parseInt(i.substr(4,2))-1,parseInt(i.substr(6,2)),parseInt(i.substr(8,2)),parseInt(i.substr(10,2)),parseInt(i.substr(12,2)))}if(m.getNamedItem("tradetime")){var i=m.getNamedItem("tradetime").value;l.tradeTime=new Date(parseInt(i.substr(0,4)),parseInt(i.substr(4,2))-1,parseInt(i.substr(6,2)),parseInt(i.substr(8,2)),parseInt(i.substr(10,2)),parseInt(i.substr(12,2)))}l.id&&(j[l.id]=l)}var l=j.combined.lastPrice?j.combined:j.previous;l.lastPrice&&(b.lastPrice=l.lastPrice),l.previousPrice&&(b.previousPrice=l.previousPrice),l.openPrice&&(b.openPrice=l.openPrice),l.highPrice&&(b.highPrice=l.highPrice),l.lowPrice&&(b.lowPrice=l.lowPrice),l.tradeSize&&(b.tradeSize=l.tradeSize),l.numberOfTrades&&(b.numberOfTrades=l.numberOfTrades),l.settlementPrice&&(b.settlementPrice=l.settlementPrice),l.volume&&(b.volume=l.volume),l.openInterest&&(b.openInterest=l.openInterest),l.timeStamp&&(b.timeStamp=l.timeStamp),l.tradeTime&&(b.tradeTime=l.tradeTime),"combined"==l.id&&j.previous.openInterest&&(b.openInterest=j.previous.openInterest)}j.combined.day&&(b.day=j.combined.day),b.type="REFRESH_QUOTE";break;default:console.log(a)}}break;case"":switch(a.substr(1,1)){case"#":b.type="TIMESTAMP",b.timestamp=new Date(parseInt(a.substr(2,4)),parseInt(a.substr(6,2))-1,parseInt(a.substr(8,2)),parseInt(a.substr(10,2)),parseInt(a.substr(12,2)),parseInt(a.substr(14,2)));break;case"2":b.record="2";var n=a.indexOf(",",0);switch(b.symbol=a.substring(2,n),b.subrecord=a.substr(n+1,1),b.unitcode=a.substr(n+3,1),b.exchange=a.substr(n+4,1),b.delay=parseInt(a.substr(n+5,2)),b.subrecord){case"0":var o=a.indexOf(",",n+7);switch(b.value=Barchart.RealtimeData.MessageParser.ParseValue(a.substring(n+7,o),b.unitcode),b.element=a.substr(o+1,1),b.modifier=a.substr(o+2,1),b.element){case"A":b.type="OPEN";break;case"C":"1"==b.modifier&&(b.type="OPEN_INTEREST");break;case"D":case"d":"0"==b.modifier&&(b.type="SETTLEMENT");break;case"V":"0"==b.modifier&&(b.type="VWAP");break;case"0":"0"==b.modifier&&(b.tradePrice=b.value,b.type="TRADE");break;case"5":b.type="HIGH";break;case"6":b.type="LOW";break;case"7":"1"==b.modifier?b.type="VOLUME_YESTERDAY":"6"==b.modifier&&(b.type="VOLUME")}b.day=a.substr(o+3,1),b.session=a.substr(o+4,1),b.time=Barchart.RealtimeData.MessageParser.ParseTimestamp(a.substr(a.indexOf("")+1,9));break;case"1":case"2":case"3":case"4":var p=a.substring(n+8).split(",");b.openPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[0],b.unitcode),b.highPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[1],b.unitcode),b.lowPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[2],b.unitcode),b.lastPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[3],b.unitcode),b.bidPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[4],b.unitcode),b.askPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[5],b.unitcode),b.previousPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[7],b.unitcode),b.settlementPrice=Barchart.RealtimeData.MessageParser.ParseValue(p[10],b.unitcode),b.volume=p[13].length>0?parseInt(p[13]):void 0,b.openInterest=p[12].length>0?parseInt(p[12]):void 0,b.day=p[14].substr(0,1),b.session=p[14].substr(1,1),b.time=Barchart.RealtimeData.MessageParser.ParseTimestamp(a.substr(a.indexOf("")+1,9)),b.type="REFRESH_DDF";break;case"7":var o=a.indexOf(",",n+7);b.tradePrice=Barchart.RealtimeData.MessageParser.ParseValue(a.substring(n+7,o),b.unitcode),n=o+1,o=a.indexOf(",",n),b.tradeSize=parseInt(a.substring(n,o)),n=o+1,b.day=a.substr(n,1),b.session=a.substr(n+1,1),b.time=Barchart.RealtimeData.MessageParser.ParseTimestamp(a.substr(a.indexOf("")+1,9)),b.type="TRADE";break;case"8":var o=a.indexOf(",",n+7);b.bidPrice=Barchart.RealtimeData.MessageParser.ParseValue(a.substring(n+7,o),b.unitcode),n=o+1,o=a.indexOf(",",n),b.bidSize=parseInt(a.substring(n,o)),n=o+1,o=a.indexOf(",",n),b.askPrice=Barchart.RealtimeData.MessageParser.ParseValue(a.substring(n,o),b.unitcode),n=o+1,o=a.indexOf(",",n),b.askSize=parseInt(a.substring(n,o)),n=o+1,b.day=a.substr(n,1),b.session=a.substr(n+1,1),b.time=Barchart.RealtimeData.MessageParser.ParseTimestamp(a.substr(a.indexOf("")+1,9)),b.type="TOB";break;case"Z":var o=a.indexOf(",",n+7);b.tradePrice=Barchart.RealtimeData.MessageParser.ParseValue(a.substring(n+7,o),b.unitcode),n=o+1,o=a.indexOf(",",n),b.tradeSize=parseInt(a.substring(n,o)),n=o+1,b.day=a.substr(n,1),b.session=a.substr(n+1,1),b.time=Barchart.RealtimeData.MessageParser.ParseTimestamp(a.substr(a.indexOf("")+1,9)),b.type="TRADE_OUT_OF_SEQUENCE"}break;case"3":var n=a.indexOf(",",0);switch(b.symbol=a.substring(2,n),b.subrecord=a.substr(n+1,1),b.subrecord){case"B":b.unitcode=a.substr(n+3,1),b.exchange=a.substr(n+4,1),b.bidDepth="A"==a.substr(n+5,1)?10:parseInt(a.substr(n+5,1)),b.askDepth="A"==a.substr(n+6,1)?10:parseInt(a.substr(n+6,1)),b.bids=[],b.asks=[];for(var p=a.substring(n+8).split(","),h=0;h<p.length;h++){var g=p[h].split(/[A-Z]/),q=p[h].substr(g[0].length,1);"J">=q?b.asks.push({price:Barchart.RealtimeData.MessageParser.ParseValue(g[0],b.unitcode),size:parseInt(g[1])}):b.bids.push({price:Barchart.RealtimeData.MessageParser.ParseValue(g[0],b.unitcode),size:parseInt(g[1])})}b.type="BOOK"}break;default:b.type="UNKNOWN"}}return b}},function(){window.Barchart||(window.Barchart={}),window.Barchart.RealtimeData||(window.Barchart.RealtimeData={})}(),Barchart.RealtimeData.Util={MonthCodes:{F:"January",G:"February",H:"March",J:"April",K:"May",M:"June",N:"July",Q:"August",U:"September",V:"October",X:"November",Z:"December"},BaseCode2UnitCode:function(a){switch(a){case-1:return"2";case-2:return"3";case-3:return"4";case-4:return"5";case-5:return"6";case-6:return"7";case 0:return"8";case 1:return"9";case 2:return"A";case 3:return"B";case 4:return"C";case 5:return"D";case 6:return"E";case 7:return"F";default:return 0}},DayCodeToNumber:function(a){var b=a.charCodeAt(0);return b>="1".charCodeAt(0)&&a<="9".charCodeAt(0)?b-"0".charCodeAt(0):a=="0".charCodeAt(0)?10:b-"A".charCodeAt(0)+11},DateToDayCode:function(a){var b=a.getDate();return b>=1&&9>=b?String.fromCharCode("1".charCodeAt(0)+b-1):10==b?"0":String.fromCharCode("A".charCodeAt(0)+b-11)},ParseSymbolType:function(a){var b=/[0-9]$/;if(b.test(a)){var c=/^(.{1,3})([A-Z])([0-9]{1,4})$/i,d=c.exec(a),e=parseInt(d[3]);return 10>e?e+=2010:100>e&&(e+=2e3),{type:"future",symbol:d[0],root:d[1],month:d[2],year:e}}return null},TimeFormatter:function(){function a(a){return[["00",a.getHours()].join("").substr(-2),["00",a.getMinutes()].join("").substr(-2),["00",a.getSeconds()].join("").substr(-2),["000",a.getMilliseconds()].join("").substr(-3)].join(":")}return{format:a}},UnitCode2BaseCode:function(a){switch(a){case"2":return-1;case"3":return-2;case"4":return-3;case"5":return-4;case"6":return-5;case"7":return-6;case"8":return 0;case"9":return 1;case"A":return 2;case"B":return 3;case"C":return 4;case"D":return 5;case"E":return 6;case"F":return 7;default:return 0}}};